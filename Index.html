<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2D6A4F">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="description" content="ØªØªØ¨Ø¹ Ù…ØµØ§Ø±ÙŠÙÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ø³Ù‡ÙˆÙ„Ø©">
<title>ÙÙŠÙ† Ù…Ø´Ø§Øª ÙÙ„ÙˆØ³ÙŠØŸ</title>

<link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogInZpbiBtc2hhdCBmbG9vc2k/IiwKICAic2hvcnRfbmFtZSI6ICJmbG9vc2kiLAogICJkZXNjcmlwdGlvbiI6ICLQqnR0YmInIG1zYXJpZmtzIGJzZWhvbGEiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzJkNkE0RiIsCiAgInRoZW1lX2NvbG9yIjogIiMyRDZBNEYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi8yNDg5LzI0ODk3NTYucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root {
    --primary: #2D6A4F; --primary-light: #40916C; --primary-dark: #1B4332;
    --accent: #F4A261; --accent-light: #FFD166; --danger: #E63946;
    --bg: #F0F4F1; --bg2: #E8F0EB; --card: #FFFFFF; --card2: #F7FAF8;
    --text: #1A2E25; --text2: #4A6858; --text3: #8BAA97;
    --border: #D4E6DA; --shadow: rgba(45,106,79,0.12); --shadow2: rgba(45,106,79,0.06);
    --radius: 20px; --radius-sm: 12px; --transition: 0.35s cubic-bezier(0.4,0,0.2,1);
    --font: 'Noto Kufi Arabic', sans-serif;
  }

  [data-theme="dark"] {
    --primary: #40916C; --primary-light: #52B788; --primary-dark: #2D6A4F;
    --bg: #0D1F17; --bg2: #122B1E; --card: #1A3328; --card2: #1F3D2F;
    --text: #E8F5EE; --text2: #95C4AB; --text3: #557A67;
    --border: #2A4A38; --shadow: rgba(0,0,0,0.4); --shadow2: rgba(0,0,0,0.2);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: var(--font); background: var(--bg); color: var(--text); min-height: 100vh; transition: background var(--transition); }
  #app { max-width: 430px; margin: 0 auto; min-height: 100vh; display: flex; flex-direction: column; position: relative; }

  /* Topbar */
  .topbar { position: sticky; top: 0; z-index: 100; background: var(--primary-dark); padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
  .topbar-logo { font-size: 18px; font-weight: 900; color: #fff; }
  .topbar-logo span { display: block; font-size: 10px; font-weight: 400; opacity: 0.7; }
  .icon-btn { width: 38px; height: 38px; border-radius: 50%; background: rgba(255,255,255,0.1); border: none; cursor: pointer; color: #fff; font-size: 18px; }

  /* Pages */
  .page { position: absolute; top: 0; left: 0; right: 0; padding: 20px 16px 100px; opacity: 0; transform: translateX(-20px); transition: 0.3s; pointer-events: none; }
  .page.active { opacity: 1; transform: translateX(0); pointer-events: all; position: relative; }

  /* Cards & Balance */
  .card { background: var(--card); border-radius: var(--radius); padding: 20px; box-shadow: 0 2px 12px var(--shadow2); border: 1px solid var(--border); margin-bottom: 16px; }
  .balance-hero { background: linear-gradient(145deg, var(--primary-dark), var(--primary)); border-radius: var(--radius); padding: 28px 24px; color: white; margin-bottom: 16px; box-shadow: 0 8px 32px rgba(45,106,79,0.3); }
  .balance-amount { font-size: 40px; font-weight: 900; }
  
  /* Inputs & Buttons */
  .form-group { margin-bottom: 16px; }
  .form-input { width: 100%; padding: 14px; border-radius: var(--radius-sm); border: 1.5px solid var(--border); background: var(--card); color: var(--text); outline: none; }
  .btn { width: 100%; padding: 16px; border-radius: var(--radius-sm); border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
  .btn-primary { background: var(--primary); color: white; }

  /* Nav */
  .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: var(--card); border-top: 1px solid var(--border); display: flex; z-index: 100; }
  .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 12px; cursor: pointer; border: none; background: none; color: var(--text3); }
  .nav-item.active { color: var(--primary); }
  
  /* Stats Grid */
  .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .cat-btn { padding: 15px; border: 2px solid var(--border); border-radius: var(--radius-sm); background: var(--card2); cursor: pointer; text-align: center; }
  .cat-btn.selected { border-color: var(--primary); background: rgba(45,106,79,0.1); }

  .expense-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
  .exp-amount { font-weight: 700; color: var(--danger); }
  .toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; opacity: 0; transition: 0.3s; z-index: 1000; }
  .toast.show { opacity: 1; }
</style>
</head>
<body>

<div id="app">
  <div class="topbar">
    <div class="topbar-logo">ÙÙŠÙ† Ù…Ø´Ø§Øª ÙÙ„ÙˆØ³ÙŠØŸ <span>ØªØªØ¨Ø¹ Ù…ØµØ§Ø±ÙŠÙÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©</span></div>
    <div class="icon-btn" id="themeToggle">ğŸŒ™</div>
  </div>

  <div class="pages-container">
    <div class="page active" id="page-dashboard">
      <div class="balance-hero" id="balanceHero">
        <div style="font-size: 12px; opacity: 0.8;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
        <div class="balance-amount"><span id="balanceAmount">0</span> <small style="font-size:18px">Ø¯Ø±Ù‡Ù…</small></div>
        <div style="margin-top: 15px; display: flex; gap: 10px;">
          <div style="flex:1; background:rgba(255,255,255,0.1); padding:10px; border-radius:10px;">
            <div style="font-size:10px">Ø§Ù„ÙŠÙˆÙ…</div>
            <div id="todayTotal" style="font-weight:700">0</div>
          </div>
          <div style="flex:1; background:rgba(255,255,255,0.1); padding:10px; border-radius:10px;">
            <div style="font-size:10px">Ø§Ù„Ø´Ù‡Ø±</div>
            <div id="monthTotal" style="font-weight:700">0</div>
          </div>
        </div>
      </div>
      <div class="card" id="recentList"></div>
    </div>

    <div class="page" id="page-add">
      <div class="card">
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
          <input type="number" id="amountInput" class="form-input" placeholder="0.00">
        </div>
        <div class="form-group">
          <label>Ø§Ù„ØµÙ†Ù</label>
          <div class="cat-grid" id="catGrid"></div>
        </div>
        <div class="form-group">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
          <input type="text" id="noteInput" class="form-input" placeholder="Ø´Ù†Ùˆ Ø´Ø±ÙŠØªÙŠØŸ">
        </div>
        <button class="btn btn-primary" id="saveExpenseBtn">Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
      </div>
    </div>

    <div class="page" id="page-budget">
      <div class="card">
        <div class="form-group">
          <label>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
          <input type="number" id="incomeInput" class="form-input">
        </div>
        <button class="btn btn-primary" id="saveBudgetBtn">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="nav-item active" data-page="dashboard">ğŸ  <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
    <button class="nav-item" data-page="add">â• <span>Ø²ÙŠØ¯</span></button>
    <button class="nav-item" data-page="budget">ğŸ¯ <span>Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span></button>
  </nav>
</div>

<div class="toast" id="toast"></div>

<script>
// --- DATA SYSTEM ---
let data = JSON.parse(localStorage.getItem('floosi_data')) || {
  expenses: [], income: 0, darkMode: false
};

const CATEGORIES = [
  {id:'food', emoji:'ğŸ”', name:'Ù…Ø§ÙƒÙ„Ø©'}, {id:'transport', emoji:'ğŸšŒ', name:'Ù†Ù‚Ù„'},
  {id:'cafe', emoji:'â˜•', name:'Ù‚Ù‡ÙˆØ©'}, {id:'other', emoji:'ğŸ“¦', name:'Ø£Ø®Ø±Ù‰'}
];

function save() { localStorage.setItem('floosi_data', JSON.stringify(data)); }

// --- UI LOGIC ---
function goTo(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');
  document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
  if(pageId === 'dashboard') renderDashboard();
  if(pageId === 'add') renderCats();
}

function renderDashboard() {
  const now = new Date().toISOString().split('T')[0];
  const todayTotal = data.expenses.filter(e => e.date === now).reduce((s,e)=> s+e.amount, 0);
  const monthTotal = data.expenses.reduce((s,e)=> s+e.amount, 0);
  
  document.getElementById('balanceAmount').textContent = (data.income - monthTotal).toLocaleString();
  document.getElementById('todayTotal').textContent = todayTotal + ' Ø¯Ø±Ù‡Ù…';
  document.getElementById('monthTotal').textContent = monthTotal + ' Ø¯Ø±Ù‡Ù…';

  const list = document.getElementById('recentList');
  list.innerHTML = '<h3>Ø¢Ø®Ø± Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3>';
  data.expenses.slice().reverse().slice(0, 5).forEach(e => {
    const cat = CATEGORIES.find(c => c.id === e.category);
    list.innerHTML += `
      <div class="expense-item">
        <span>${cat.emoji}</span>
        <div style="flex:1">${cat.name} <br><small>${e.note}</small></div>
        <div class="exp-amount">-${e.amount}</div>
      </div>
    `;
  });
}

let selectedCat = 'food';
function renderCats() {
  const grid = document.getElementById('catGrid');
  grid.innerHTML = CATEGORIES.map(c => `
    <div class="cat-btn ${selectedCat === c.id ? 'selected' : ''}" onclick="selectedCat='${c.id}';renderCats()">
      ${c.emoji}<br>${c.name}
    </div>
  `).join('');
}

// --- EVENT LISTENERS ---
document.getElementById('saveExpenseBtn').addEventListener('click', () => {
  const amount = parseFloat(document.getElementById('amountInput').value);
  if(!amount) return showToast('ÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº!');
  data.expenses.push({
    amount, category: selectedCat, note: document.getElementById('noteInput').value,
    date: new Date().toISOString().split('T')[0]
  });
  save(); showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…'); goTo('dashboard');
});

document.getElementById('saveBudgetBtn').addEventListener('click', () => {
  data.income = parseFloat(document.getElementById('incomeInput').value) || 0;
  save(); showToast('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…');
});

document.querySelectorAll('.nav-item').forEach(btn => {
  btn.addEventListener('click', () => goTo(btn.dataset.page));
});

function showToast(m) {
  const t = document.getElementById('toast'); t.textContent = m;
  t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000);
}

// --- PWA & SERVICE WORKER ---
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'floosi-v1';
    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE).then(c => c.add(location.href))));
    self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => caches.match(e.request))));
  `;
  const blob = new Blob([swCode], {type: 'text/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}

renderDashboard();
</script>
</body>
</html>
